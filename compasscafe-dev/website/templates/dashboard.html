{% extends "template.html" %}{% block title %}Dashboard{% endblock %} {% block
content %}

<!- - Sort User - ->
<form method="GET" action="{{ url_for('views.dashboard') }}">
  {{ sort_form.hidden_tag() }}
  <div id="mobile-sortjsPopup" class="mobilefilterpopup">
    <button id="mobisortPopClose" type="button">
      <i class="fa fa-times"></i>
    </button>
    <!- - Close Button - ->
    <div class="popup-content">
      <ul>
        <li>
          <label>Sort By</label><br />
          <select name="sort_by" id="sort_by" class="form-control">
            <option value="">None</option>
            <option value="email_asc" {% if request.args.get('sort_by') == 'email_asc' %}selected{% endif %}>Email (Ascending)</option>
            <option value="email_desc" {% if request.args.get('sort_by') == 'email_desc' %}selected{% endif %}>Email (Descending)</option>
            <option value="is_staff_asc" {% if request.args.get('sort_by') == 'is_staff_asc' %}selected{% endif %}>Admin Status (Ascending)</option>
            <option value="is_staff_desc" {% if request.args.get('sort_by') == 'is_staff_desc' %}selected{% endif %}>Admin Status (Descending)</option>
          </select>
          <! - - Retain Filter Values - ->
          <input
            type="hidden"
            name="email"
            value="{{ request.args.get('email', '') }}"
          />
          <input
            type="hidden"
            name="is_staff_true"
            value="{{ request.args.get('is_staff_true', '') }}"
          />
          <input
            type="hidden"
            name="is_staff_false"
            value="{{ request.args.get('is_staff_false', '') }}"
          />
        </li>
        <br />
        <li class="last-list">
          <button type="submit" class="btn-primary">
            {{ sort_form.submit.label.text }}
          </button>
          <!- - Submit Sort Button - ->
        </li>
      </ul>
    </div>
  </div>
</form>
<!- - End of Sort - ->

<!- - Filter User - ->
<form
  method="POST"
  action="{{ url_for('views.dashboard', sort_by=request.args.get('sort_by')) }}"
>
  {{ filter_form.hidden_tag() }}
  <div id="mobile-filterjsPopup" class="mobilefilterpopup">
    <button id="mobifilterPopClose" type="button">
      <i class="fa fa-times"></i>
    </button>
    <!- - Close Button - ->
    <div class="popup-content">
      <ul>
        <li>
          <label>Email</label><br />
          {{ filter_form.email(size=32) }}
        </li>
        <br />
        <li>{{ filter_form.is_staff_true() }} Is Admin</li>
        <br />
        <li>{{ filter_form.is_staff_false() }} Not Admin</li>
        <br />
        <li class="last-list">
          <button type="submit" name="filter_submit" class="btn-primary">
            Filter
          </button>
          <! - - Submit Filter Button - - >
        </li>
        <li style="display: inline-block" class="last-list">
          <a href="{{ url_for('views.dashboard') }}" class="btn-secondary"
            >Clear Filters</a
          >
          <! - - Clear Filter Button - - >
        </li>
      </ul>
    </div>
  </div>
</form>
<!- - End of Filter User - ->

<!-- Blank Space -->
<section class="beigespace-test">
  <br />
  <br />
  <div class="preload-fadein">
    <div class="row mb-4">
      <div class="col-md-12 col-lg-6">
        <h1>Dashboard</h1>
      </div>
      <div class="head-directory col-md-12 col-lg-6 justify-content-end">
        <a id="direct-selected">users</a> / <a href="/dashboard">dashboard</a> /
        <a href="/home">home</a>
      </div>
    </div>
    <br />
    <div class="row">
      <div class="col-lg-12 col-xl-3">
        <div class="panel-sidetable dash-sides mb-4">
          <div class="logas-dash">
            <label id="loggedinas-dash" title="{{ user.email }}">
              <strong>Logged in as: {{ user.schoolid }}</strong><br />
              {{ user.email }}
            </label>
          </div>
        </div>
        <div class="panel-sidetable dash-sides mb-4">
          <ul>
            <ul>
              <h6>Admin Settings</h6>
              <li><a href="/dashboard">users</a></li>
              <li><a href="/apply">applications</a></li>
            </ul>
            <br />
            <ul>
              <h6>User Settings</h6>
              <li><a href="/settings">account</a></li>
            </ul>
          </ul>
        </div>
        <div class="panel-sidetable dash-sides">
          <ul>
            <h6>Site Settings</h6>
            <li><a href="{{ url_for('views.menuEdit') }}">menu</a></li>
          </ul>
        </div>
        <br />
      </div>
      <div class="col-lg-12 col-xl-9">
        <div class="dashboarduser-table dash-hello mb-4">
          <h2>Hello, {{ user.schoolid }}! ðŸ‘‹</h2>
          <p>
            <strong>Welcome to the admin dashboard.</strong> <br />Here you can
            manage users and applications.
          </p>
          <p>
            <img
              class="d-none d-sm-block"
              src="/static/assets/media/coffeebounce.gif"
              alt="cup of coffee"
              draggable="false"
              oncontextmenu="return false;"
            />
          </p>
        </div>

        <!- - User Interactives - ->
        {% if edit_user_id %}
        <div class="dashboarduser-table">
          <h3>Edit User</h3>
          <br />
          <form
            method="POST"
            action="{{ url_for('views.dashboard', edit_user_id=edit_user_id) }}"
          >
            {{ edit_form.hidden_tag() }}
            <! - - Email Input - - >
            <p>
              {{ edit_form.email.label }}<br />
              {{ edit_form.email(size=32) }}
            </p>
            <! - - School ID Input - - >
            <p>
              {{ edit_form.schoolid.label }}<br />
              {{ edit_form.schoolid(size=32) }}
            </p>
            <! - - Password Input - - >
            <p>
              {{ edit_form.password.label }}<br />
              {{ edit_form.password(size=32) }}<br />
            </p>
            <! - - Confirm Password Input - - >
            <p>
              {{ edit_form.confirm_password.label }}<br />
              {{ edit_form.confirm_password(size=32, id="confirm_password") }}
            </p>
            <! - - Show Password Checkbox - - >
            <input
              type="checkbox"
              id="showPassword"
              onclick="togglePassword()"
            />
            Show Password
            <! - - Admin Status Boolean - - >
            <p>{{ edit_form.is_staff() }} Admin Privileges</p>
            <! - - Submit Buttons - - >
            <br />
            <button type="submit" name="edit_submit" class="btn-primary">
              Update User
            </button>
            <a
              class="btn-secondary"
              href="{{ url_for('views.dashboard') }}"
              style="margin-left: 10px"
              >Cancel</a
            >
          </form>
        </div>
        <br />
        {% endif %}

        <!- - User List with Interactables - ->
        <div class="dashboarduser-table adminusersheet">
          <!- - User Views - ->
          <div id="sortbuttons">
            <h3>Users</h3>
            <ul class="buttonclass">
              <!- - Sort User - ->
              <li>
                <form method="GET" action="{{ url_for('views.dashboard') }}">
                  {{ sort_form.hidden_tag() }}
                  <button id="sortPopBTN" class="btn-secondary" type="button">
                    Sort
                  </button>
                  <!- - Pop Up Sort Button - ->

                  <div id="sortjsPopup" class="filterpopup">
                    <div class="popup-content">
                      <ul>
                        <li>
                          <label>Sort By</label><br />
                          <select name="sort_by" id="sort_by" class="form-control">
                            <option value="">None</option>
                            <option value="email_asc" {% if request.args.get('sort_by') == 'email_asc' %}selected{% endif %}>Email (Ascending)</option>
                            <option value="email_desc" {% if request.args.get('sort_by') == 'email_desc' %}selected{% endif %}>Email (Descending)</option>
                            <option value="is_staff_asc" {% if request.args.get('sort_by') == 'is_staff_asc' %}selected{% endif %}>Admin Status (Ascending)</option>
                            <option value="is_staff_desc" {% if request.args.get('sort_by') == 'is_staff_desc' %}selected{% endif %}>Admin Status (Descending)</option>
                          </select>
                          <! - - Retain Filter Values - ->
                          <input
                            type="hidden"
                            name="email"
                            value="{{ request.args.get('email', '') }}"
                          />
                          <input
                            type="hidden"
                            name="is_staff_true"
                            value="{{ request.args.get('is_staff_true', '') }}"
                          />
                          <input
                            type="hidden"
                            name="is_staff_false"
                            value="{{ request.args.get('is_staff_false', '') }}"
                          />
                        </li>
                        <br />
                        <li class="last-list">
                          <button type="submit" class="btn-primary">
                            {{ sort_form.submit.label.text }}
                          </button>
                          <!- - Submit Sort Button - ->
                        </li>
                      </ul>
                    </div>
                  </div>
                </form>
              </li>
              <!- - End of Sort - ->

              <!- - Filter User - ->
              <li>
                <form
                  method="POST"
                  action="{{ url_for('views.dashboard', sort_by=request.args.get('sort_by')) }}"
                >
                  {{ filter_form.hidden_tag() }}
                  <button id="filterPopBTN" class="btn-secondary" type="button">
                    Filter
                  </button>
                  <! - - Pop Up Filter Button - - >

                  <div id="filterjsPopup" class="filterpopup">
                    <div class="popup-content">
                      <ul>
                        <li>
                          <label>Email</label><br />
                          {{ filter_form.email(size=32) }}
                        </li>
                        <br />
                        <li>{{ filter_form.is_staff_true() }} Is Admin</li>
                        <br />
                        <li>{{ filter_form.is_staff_false() }} Not Admin</li>
                        <br />
                        <li class="last-list">
                          <button
                            type="submit"
                            name="filter_submit"
                            class="btn-primary"
                          >
                            Filter
                          </button>
                          <! - - Submit Filter Button - - >
                        </li>
                        <li style="display: inline-block" class="last-list">
                          <a
                            href="{{ url_for('views.dashboard') }}"
                            class="btn-secondary"
                            >Clear Filters</a
                          >
                          <! - - Clear Filter Button - - >
                        </li>
                      </ul>
                    </div>
                  </div>
                </form>
              </li>
              <!- - End of Filter User - ->
            </ul>
          </div>

          <table class="mb-4">
            <tr class="dashboarduser-header">
              <th>Email</th>
              <th class="dash-showmain">Admin</th>
              <th class="dash-showmain">Configure</th>
              <th class="dash-showmain">Delete</th>
              <th class="dash-showmobile">Settings</th>
            </tr>
            {% for user in paginUsers.items %}
            <tr id="dashboard-list">
              <! - - User Email - ->
              <td id="emailconfig" class="emailelipsis">{{ user.email }}</td>
              <! - - Admin Status - ->
              <td id="configicon" class="dash-showmain">
                {% if user.is_staff %}
                <i class="fas fa-check" title="Admin User"></i>
                {% else %}
                <i class="fas fa-times" title="Regular User"></i>
                {% endif %}
              </td>
              <! - - Edit User - ->
              <td id="configicon" class="dash-showmain">
                <a
                  id="edituser_dash"
                  href="{{ url_for('views.dashboard', edit_user_id=user.id) }}"
                >
                  <button class="dashboarduseredit" type="submit">
                    <i class="fa fa-pencil" title="Edit User"></i>
                  </button>
                </a>
              </td>
              <! - - Delete User - - >
              <td id="configicon" class="dash-showmain">
                <! - - Trigger Confirmation Popup - - >
                <button
                  class="dashboarduseredit"
                  onclick="showDeletePopup(this)"
                  data-item-type="user"
                  data-item-id="{{ user.id }}"
                  data-item-description="User: {{ user.email }}"
                >
                  <i class="fa fa-trash" title="Delete User"></i>
                </button>
              </td>

              <! - - Dropdown Button - Visible on Smaller Screens - ->
              <td class="dash-showmobile">
                <div class="btn-group" id="apply-delete">
                  <button
                    type="button"
                    class="btn-secondary dropdown-toggle"
                    data-bs-toggle="dropdown"
                  ></button>
                  <ul class="dropdown-menu">
                    <h6 class="dropdown-header">{{ user.email }}</h6>
                    <li>
                      <a class="dropdown-item">
                        {% if user.is_staff %}
                        <i class="fas fa-check" title="Admin User"></i>
                        {% else %}
                        <i class="fas fa-times" title="Regular User"></i>
                        {% endif %} Admin
                      </a>
                    </li>
                    <li>
                      <a
                        class="dropdown-item"
                        href="{{ url_for('views.dashboard', edit_user_id=user.id) }}"
                        type="submit"
                      >
                        Configure
                      </a>
                    </li>
                    <li>
                      <form
                        action="{{ url_for('views.delete_user', user_id=user.id) }}"
                        method="POST"
                        onsubmit="return false;"
                      >
                        <! - - Trigger Confirmation Popup - - >
                        <button
                          class="dashboarduseredit"
                          onclick="showDeletePopup(this)"
                          data-item-type="user"
                          data-item-id="{{ user.id }}"
                          data-item-description="User: {{ user.email }}"
                        >
                          Delete
                        </button>
                      </form>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
            {% endfor %}
          </table>

          <div class="row pagination-row">
            <!-- Pagination -->
            {% for page in paginEntries.pages %} {% if page.url and page.num %}
            {% if page.current %}
            <a
              class="pagination-btn pgntnbtn-info current"
              href="{{ page.url }}"
              >{{ page.num }}</a
            >
            {% else %}
            <a
              class="pagination-btn pgntnbtn-outline-info"
              href="{{ page.url }}"
              >{{ page.num }}</a
            >
            {% endif %} {% else %} ... {% endif %} {% endfor %}
            <!-- End of Pagination -->
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- End of Blank Space -->

{% endblock %}
